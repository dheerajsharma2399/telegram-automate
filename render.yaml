services:
  - type: web
    name: telegram-job-scraper
    env: python
    plan: free
    buildCommand: "pip install -r requirements.txt"
    startCommand: "python web_server.py"
    envVars:
      - key: TELEGRAM_BOT_TOKEN
        fromSecret: true
      - key: ADMIN_USER_ID
        fromSecret: true
      - key: DATABASE_URL
        fromSecret: true
      - key: OPENROUTER_API_KEY
        fromSecret: true
      - key: GOOGLE_CREDENTIALS_JSON
        fromSecret: true
      - key: SPREADSHEET_ID
        fromSecret: true
      - key: CONTAINER_TYPE
        value: web
      - key: BOT_RUN_MODE
        value: webhook
      - key: PORT
        value: "10000"
      - key: FLASK_ENV
        value: production
    autoDeploy: true
    healthCheckPath: /health

  - type: worker
    name: telegram-job-bot
    env: python
    plan: free
    buildCommand: "pip install -r requirements.txt"
    startCommand: "python main.py"
    envVars:
      - key: TELEGRAM_API_ID
        fromSecret: true
      - key: TELEGRAM_API_HASH
        fromSecret: true
      - key: TELEGRAM_PHONE
        fromSecret: true
      - key: TELEGRAM_BOT_TOKEN
        fromSecret: true
      - key: TELEGRAM_GROUP_USERNAMES
        fromSecret: true
      - key: AUTHORIZED_USER_IDS
        fromSecret: true
      - key: OPENROUTER_API_KEY
        fromSecret: true
      - key: DATABASE_URL
        fromSecret: true
      - key: CONTAINER_TYPE
        value: bot
      - key: BOT_RUN_MODE
        value: webhook
    autoDeploy: true
